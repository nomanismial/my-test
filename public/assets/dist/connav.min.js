;(function(f){var h=function(e,g){var a=this,k=f("body"),h=f(window),l=!1,r;this.el=e instanceof f?e:f(e);this.wrapper;this.contentBlocks;this.table=f("<div>",{"class":"connav-table-content"});this.indexTypes=[];this.tree=[];this.blocksByLevel=[];this.blocks=[];this.settings=f.extend(!0,{},{wrapper:"body",updateURL:!1,autoId:!0,content:".connav-block",autocontent:".connav-auto-block",title:"",indexOnTable:!0,indexOnContent:!1,indexType:"1.1.1",nestedIndex:!0,marginTop:0,btnCollapse:'<div class="connav-btn-collapse"></div>',
autocollapse:!1,collapsable:!1},g);var v=function(){document.body.contains(a.el[0])&&(r&&clearTimeout(r),r=setTimeout(function(){a.contentBlocks.each(function(){var b=f(this).data("connav-block");a.setBounderies(b)})},500))},w=function(){if(!l&&document.body.contains(a.el[0]))for(var b=k.scrollTop(),d=a.blocksByLevel.length-1;0<=d;d--)for(var c=0,f=a.blocksByLevel[d].length;c<f;c++){var e=a.blocksByLevel[d][c];if(b>e.offset.top&&b<e.offset.bottom){e.focus||(a.desactivate(),a.activate(e));return}}},
x=function(b,d){var c;switch(a.indexTypes[d?d.level:0]){case null:c="";break;case "uppercase":c=String.fromCharCode(b+65)+".";break;case "lowercase":c=String.fromCharCode(b+97)+".";break;default:c=b+1+"."}d&&0!=c&&0!=d.indexToShow&&a.settings.nestedIndex&&(c=d.indexToShow+c);return c},y=function(){var b=a.wrapper.find(a.settings.autocontent);if(b.length)for(var d=["h2","h3","h4","h5","h6"],c=0,e=d.length;c<e;c++)b.find(d[c]).each(function(){f(this).nextUntil(d[c]).andSelf().wrapAll('<div class="connav-block"></div>')})},
z=function(){a.contentBlocks=a.wrapper.find(a.settings.content);a.contentBlocks.addClass("connav-block");a.contentBlocks.each(function(){var a=f(this),d=a.parents(".connav-block");a.addClass("connav-level-"+(d.length+1))})},t=function(a){if(a.node[0].id){var d=window.location.href.replace(window.location.hash,"");window.history.replaceState("",document.title,d+"#"+a.node[0].id)}else a.parent&&t(a.parent)},A=function(){a.settings.btnCollapse&&f.each(a.tree,function(a,d){u(d)})},u=function(b){b.children.length&&
(f(a.settings.btnCollapse).click(function(){a.toggleCollapse(b.tableNode)}).prependTo(b.tableNode.children(".connav-table-item-title")),a.settings.autocollapse&&b.tableNode.addClass("collapsed"),f.each(b.children,function(a,b){u(b)}))};this.setBounderies=function(b){b.offset={top:b.node.offset().top-a.settings.marginTop,bottom:b.node.offset().top+b.node.outerHeight()-a.settings.marginTop}};this.updateBounderies=function(){f.each(a.blocks,function(b,d){a.setBounderies(d)})};this.addToTree=function(b,
d,c){if(b&&b!==a.tree){var e=c?c.children:a.tree;c=c||null;var k=b.parents(".connav-block").length+1,g=x(d,c),m=b.find("h"+(k+1)),n=0!=a.settings.title?b.children(a.settings.title):!1,h="";n&&n.length?h=n.text():m.length&&(h=m.text());if(a.settings.indexOnContent&&0!=g){var q='<span class="connav-block-index">'+g+"</span>";n&&n.length?n.prepend(q):m.length&&m.prepend(q)}var m=f('<div class="connav-table-item connav-table-level-'+k+'"></div>'),n='<span class="connav-table-item-index">'+g+"</span>",
q=f('<span class="connav-table-item-text">'+h+"</span>"),l=f('<div class="connav-table-item-title"></div>');a.settings.indexOnTable&&0!=g&&l.prepend(n);l.append(q);m.append(l);c&&m.appendTo(c.tableNode);var p={index:d+1,level:k,node:b,title:h,parent:c,children:[],tableNode:m,indexToShow:g,focus:!1,offset:{}};a.setBounderies(p);e.push(p);a.blocks.push(p);a.blocksByLevel[k-1]||(a.blocksByLevel[k-1]=[]);a.blocksByLevel[k-1].push(p);b.data("connav-block",p);q.click(function(){a.goTo(p)});b.children(".connav-block").each(function(b,
c){var d=f(this);a.addToTree(d,b,p)})}else a.contentBlocks.filter(".connav-level-1").each(function(b,c){var d=f(this);a.addToTree(d,b);d.data("connav-block").tableNode.appendTo(a.table)})};this.goTo=function(b){l||(l=!0,f("body, html").animate({scrollTop:b.offset.top},function(){setTimeout(function(){l=!1},50)}),a.desactivate(),a.activate(b))};this.desactivate=function(){var b=a.table.find(".active");a.settings.btnCollapse&&a.settings.autocollapse&&a.closeCollapse(b);b.removeClass("active").removeClass("focus");
for(var b=0,d=a.blocks.length;b<d;b++)a.blocks[b].focus&&(a.blocks[b].focus=!1)};this.activate=function(b,d){d||(b.focus=!0,b.tableNode.addClass("focus"),a.settings.updateURL&&window.history.replaceState&&t(b),a.el.trigger("connavChange",b));b.tableNode.addClass("active");b.parent&&a.activate(b.parent,!0);a.settings.btnCollapse&&a.settings.autocollapse&&a.openCollapse(b.tableNode)};this.toggleCollapse=function(b){b.hasClass("collapsed")?a.openCollapse(b):a.closeCollapse(b)};this.openCollapse=function(b){b.removeClass("collapsed");
a.el.trigger("connavToggleCollapse",b);setTimeout(a.updateBounderies,100)};this.closeCollapse=function(b){b.addClass("collapsed");a.el.trigger("connavToggleCollapse",b);setTimeout(a.updateBounderies,100)};(function(){a.wrapper=f(a.settings.wrapper);for(var b=a.settings.indexType.split("."),d=0,c=b.length;d<c;d++){var e=b[d];0<parseInt(e)?a.indexTypes[d]="number":0==e?a.indexTypes[d]=null:e==e.toUpperCase()?a.indexTypes[d]="uppercase":e==e.toLowerCase()&&(a.indexTypes[d]="lowercase")}y();z();a.addToTree();
a.el.append(a.table);a.settings.collapsable&&A();if(a.settings.autoId)for(b=0,d=a.blocks.length;b<d;b++)if(!a.blocks[b].node[0].id&&0!=a.blocks[b].title){c=a.blocks[b].title;c=c.replace(/^\s+|\s+$/g,"");c=c.toLowerCase();c=c.replace(/^([^abcdefghijklmnopqrstuvwxyz]+)/g,"");for(e=0;31>e;e++)c=c.replace(new RegExp("\u00e3\u00e0\u00e1\u00e4\u00e2\u1ebd\u00e8\u00e9\u00eb\u00ea\u00ec\u00ed\u00ef\u00ee\u00f5\u00f2\u00f3\u00f6\u00f4\u00f9\u00fa\u00fc\u00fb\u00f1\u00e7\u00b7/_,:;".charAt(e),"g"),"aaaaaeeeeeiiiiooooouuuunc------".charAt(e));
c=c.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"_").replace(/-+/g,"_").replace(/_*$/g,"").replace(/__+/g,"_");if(document.getElementById(c))for(e=2;0<e;e++)if(!document.getElementById(c+"_"+e)){c=c+"_"+e;break}a.blocks[b].node[0].id=c}window.location.hash&&(b=f(window.location.hash),b.length&&b.data("connav-block")&&a.goTo(b.data("connav-block")));h.on("scroll",w);h.on("resize",v);a.updateBounderies();a.el.trigger("connavReady",a)})()};f.fn.contentNavigator=function(e){var g=arguments;if(void 0===
e||"object"===typeof e)return this.each(function(){f.data(this,"contentNavigator")||f.data(this,"contentNavigator",new h(this,e))});if("string"===typeof e&&"_"!==e[0]&&"init"!==e){if("instance"===e)return f.data(this[0],"contentNavigator");if(0==Array.prototype.slice.call(g,1).length&&-1!=f.inArray(e,f.fn.contentNavigator.getters)){var a=f.data(this[0],"contentNavigator");return a[e].apply(a,Array.prototype.slice.call(g,1))}return this.each(function(){var a=f.data(this,"contentNavigator");a instanceof
h&&"function"===typeof a[e]&&a[e].apply(a,Array.prototype.slice.call(g,1))})}};f.fn.contentNavigator.getters=[]})(jQuery);